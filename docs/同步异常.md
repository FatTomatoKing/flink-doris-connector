#### 1.异常mysql未配置 binlog 为 row 模式

```
ource: MySQL Source (1/1) (6e1128cb9347e248e5eb2f17e94f0dd6_bc764cd8ddf7a0cff126f51c16239658_0_430) switched from DEPLOYING to INITIALIZING.
16:49:47,845 INFO  org.apache.flink.runtime.taskexecutor.slot.TaskSlotTableImpl [flink-pekko.actor.default-dispatcher-7] [] - Activate slot 344ca58f9a43039a06d5270c83beb07e.
16:49:47,845 INFO  org.apache.flink.runtime.taskmanager.Task                    [Process (1/1)#430] [] - Process (1/1)#430 (6e1128cb9347e248e5eb2f17e94f0dd6_0a448493b4782967b150582570326227_0_430) switched from CREATED to DEPLOYING.
16:49:47,846 INFO  io.debezium.jdbc.JdbcConnection                              [pool-434-thread-1] [] - Connection gracefully closed
16:49:47,846 INFO  org.apache.flink.runtime.taskmanager.Task                    [Process (1/1)#430] [] - Loading JAR files for task Process (1/1)#430 (6e1128cb9347e248e5eb2f17e94f0dd6_0a448493b4782967b150582570326227_0_430) [DEPLOYING].
16:49:47,846 ERROR org.apache.flink.runtime.source.coordinator.SourceCoordinator [Thread-446] [] - Failed to create Source Enumerator for source Source: MySQL Source
org.apache.flink.table.api.ValidationException: The MySQL server is configured with binlog_format MIXED rather than ROW, which is required for this connector to work properly. Change the MySQL configuration to use a binlog_format=ROW and restart the connector.
	at org.apache.flink.cdc.connectors.mysql.MySqlValidator.checkBinlogFormat(MySqlValidator.java:131) ~[flink-sql-connector-mysql-cdc-3.2.1.jar:3.2.1]
	at org.apache.flink.cdc.connectors.mysql.MySqlValidator.validate(MySqlValidator.java:73) ~[flink-sql-connector-mysql-cdc-3.2.1.jar:3.2.1]
	at org.apache.flink.cdc.connectors.mysql.source.MySqlSource.createEnumerator(MySqlSource.java:200) ~[flink-sql-connector-mysql-cdc-3.2.1.jar:3.2.1]
	at org.apache.flink.runtime.source.coordinator.SourceCoordinator.start(SourceCoordinator.java:221) ~[flink-runtime-1.18.0.jar:1.18.0]
	at org.apache.flink.runtime.operators.coordination.RecreateOnResetOperatorCoordinator$DeferrableCoordinator.resetAndStart(RecreateOnResetOperatorCoordinator.java:416) ~[flink-runtime-1.18.0.jar:1.18.0]
	at org.apache.flink.runtime.operators.coordination.RecreateOnResetOperatorCoordinator.lambda$resetToCheckpoint$7(RecreateOnResetOperatorCoordinator.java:156) ~[flink-runtime-1.18.0.jar:1.18.0]
	at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774) ~[?:1.8.0_381]
	at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750) ~[?:1.8.0_381]
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) ~[?:1.8.0_381]
	at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975) ~[?:1.8.0_381]
	at org.apache.flink.runtime.operators.coordination.ComponentClosingUtils.lambda$closeAsyncWithTimeout$0(ComponentClosingUtils.java:77) ~[flink-runtime-1.18.0.jar:1.18.0]
	at java.lang.Thread.run(Thread.java:750) [?:1.8.0_381]
16:49:47,846 INFO  org.apache.flink.runtime.taskexecutor.TaskExecutor           [flink-pekko.actor.default-dispatcher-7] [] - Received task app_event_log: Writer (1/1)#430 (6e1128cb9347e248e5eb2f17e94f0dd6_2154fa1373714cd132fb53d194efc52e_0_430), deploy into slot with allocation id 344ca58f9a43039a06d5270c83beb07e.
16:49:47,846 INFO  org.apache.flink.runtime.taskexecutor.slot.TaskSlotTableImpl [flink-pekko.actor.default-dispatcher-7] [] - Activate slot 344ca58f9a43039a06d5270c83beb07e.
16:49:47,846 INFO  org.apache.flink.streaming.runtime.tasks.StreamTask          [Process (1/1)#430] [] - No state backend has been configured, using default (HashMap) org.apache.flink.runtime.state.hashmap.HashMapStateBackend@210acb1
16:49:47,846 INFO  org.apache.flink.runtime.state.StateBackendLoader            [Process (1/1)#430] [] - State backend loader loads the state backend as HashMapStateBackend
16:49:47,846 INFO  org.apache.flink.streaming.runtime.tasks.StreamTask          [Process (1/1)#430] [] - Checkpoint storage is set to 'jobmanager'
16:49:47,846 INFO  org.apache.flink.runtime.taskmanager.Task                    [Process (1/1)#430] [] - Process (1/1)#430 (6e1128cb9347e248e5eb2f17e94f0dd6_0a448493b4782967b150582570326227_0_430) switched from DEPLOYING to INITIALIZING.
16:49:47,846 INFO  org.apache.flink.runtime.jobmaster.JobMaster                 [flink-pekko.actor.default-dispatcher-6] [] - Trying to recover from a global failure.
org.apache.flink.util.FlinkException: Global failure triggered by OperatorCoordinator for 'Source: MySQL Source' (operator bc764cd8ddf7a0cff126f51c16239658).
	at org.apache.flink.runtime.operators.coordination.OperatorCoordinatorHolder$LazyInitializedCoordinatorContext.failJob(OperatorCoordinatorHolder.java:624) ~[flink-runtime-1.18.0.jar:1.18.0]
	at org.apache.flink.runtime.operators.coordination.RecreateOnResetOperatorCoordinator$QuiesceableContext.failJob(RecreateOnResetOperatorCoordinator.java:248) ~[flink-runtime-1.18.0.jar:1.18.0]
	at org.apache.flink.runtime.source.coordinator.SourceCoordinatorContext.failJob(SourceCoordinatorContext.java:395) ~[flink-runtime-1.18.0.jar:1.18.0]
	at org.apache.flink.runtime.source.coordinator.SourceCoordinator.start(SourceCoordinator.java:225) ~[flink-runtime-1.18.0.jar:1.18.0]
	at org.apache.flink.runtime.operators.coordination.RecreateOnResetOperatorCoordinator$DeferrableCoordinator.resetAndStart(RecreateOnResetOperatorCoordinator.java:416) ~[flink-runtime-1.18.0.jar:1.18.0]
	at org.apache.flink.runtime.operators.coordination.RecreateOnResetOperatorCoordinator.lambda$resetToCheckpoint$7(RecreateOnResetOperatorCoordinator.java:156) ~[flink-runtime-1.18.0.jar:1.18.0]
	at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774) ~[?:1.8.0_381]
	at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750) ~[?:1.8.0_381]
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) ~[?:1.8.0_381]
	at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975) ~[?:1.8.0_381]
	at org.apache.flink.runtime.operators.coordination.ComponentClosingUtils.lambda$closeAsyncWithTimeout$0(ComponentClosingUtils.java:77) ~[flink-runtime-1.18.0.jar:1.18.0]
	at java.lang.Thread.run(Thread.java:750) ~[?:1.8.0_381]
Caused by: org.apache.flink.table.api.ValidationException: The MySQL server is configured with binlog_format MIXED rather than ROW, which is required for this connector to work properly. Change the MySQL configuration to use a binlog_format=ROW and restart the connector.
	at org.apache.flink.cdc.connectors.mysql.MySqlValidator.checkBinlogFormat(MySqlValidator.java:131) ~[flink-sql-connector-mysql-cdc-3.2.1.jar:3.2.1]
	at org.apache.flink.cdc.connectors.mysql.MySqlValidator.validate(MySqlValidator.java:73) ~[flink-sql-connector-mysql-cdc-3.2.1.jar:3.2.1]
	at org.apache.flink.cdc.connectors.mysql.source.MySqlSource.createEnumerator(MySqlSource.java:200) ~[flink-sql-connector-mysql-cdc-3.2.1.jar:3.2.1]
	at org.apache.flink.runtime.source.coordinator.SourceCoordinator.start(SourceCoordinator.java:221) ~[flink-runtime-1.18.0.jar:1.18.0]
	... 8 more
```

![image-20260109164953898](同步异常.assets/image-20260109164953898-1767948596632-1.png)

2.权限 必须具备从库读写权限

```sql
mysql -uroot -p

GRANT SELECT, RELOAD, SHOW DATABASES, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'zard-payout-mock'@'%';
FLUSH PRIVILEGES;
SHOW GRANTS FOR 'zard-payout-mock'@'%';
```



我自己的库发现有这个问题所以重置了索引

```
-- 1. 停止 MySQL（在服务器上执行）
systemctl stop mysql

-- 2. 删除所有 binlog 文件和索引（在服务器上执行）
cd /www/server/data/
rm -f mysql-bin.*

-- 3. 启动 MySQL
systemctl start mysql

-- 4. 验证
mysql -u root -p -e "SHOW BINARY LOGS;"
```

一些临时验证脚本

```
-- 1. 检查 binlog 内容是否存在
SHOW BINLOG EVENTS IN 'mysql-bin.000006' LIMIT 10;

-- 2. 检查 binlog 的起始位置
SHOW BINLOG EVENTS IN 'mysql-bin.000006' FROM 772 LIMIT 5;

-- 3. 查看所有 binlog 文件
SHOW BINARY LOGS;

-- 4. 检查 GTID 配置
SHOW VARIABLES LIKE 'gtid%';

-- 5. 检查 server_id
SHOW VARIABLES LIKE 'server_id';

-- 6. 查看 binlog 格式
SHOW VARIABLES LIKE 'binlog_format';
```

